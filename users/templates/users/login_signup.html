{% extends "base.html" %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'deps/css/my_footer_css.css' %}">
  <link rel="stylesheet" href="{% static 'deps/css/login_signup.css' %}">
  <!-- Подключаем Bootstrap Icons для иконок в полях ввода -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Подключаем стили для intl-tel-input -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
{% endblock %}

{% block content %}
{# Используем active_form из контекста для установки класса signup-mode #}
{# Добавляем data-атрибут для передачи active_form в JavaScript #}
<div class="login-signup-container {% if active_form == 'signup' %}signup-mode{% endif %}" data-active-form="{{ active_form }}">
    <!-- Форма входа (левая сторона) -->
    <div id="login-section">
        <h2 class="form-title">Вхід</h2>
        <form method="post" action="{% url 'users:login_signup' %}" autocomplete="off">
            {% csrf_token %}
            <input type="hidden" name="action" value="login">
            
            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-person"></i>
                    <input type="text" name="username" id="id_username" placeholder="Логін" required autocomplete="off">
                </div>
            </div>
            {% if login_form.username.errors %}
                <div class="alert alert-danger p-1 small">{{ login_form.username.errors|join:", " }}</div>
            {% endif %}
            
            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-lock"></i>
                    <input type="password" name="password" id="id_password" placeholder="Пароль" required autocomplete="new-password">
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('id_password', this)">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
            </div>
            {% if login_form.password.errors %}
                <div class="alert alert-danger p-1 small">{{ login_form.password.errors|join:", " }}</div>
            {% endif %}
            
            <!-- Общие ошибки формы входа -->
            {% if login_form.non_field_errors %}
                <div class="alert alert-danger p-1 small">
                    {% for error in login_form.non_field_errors %}
                       {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            
            <button type="submit" class="btn submit-btn">Увійти</button>
            
            <p class="switch-text">Ще немає облікового запису? <a href="#signup-section" id="show-signup">Зареєструватися</a></p>
        </form>
    </div>
    
    <!-- Приветственный текст (правая сторона для логина) -->
    <div id="login-welcome-panel" class="welcome-panel">
        <div class="welcome-content">
            <h3>ЛАСКАВО ПРОСИМО!</h3>
            <p>Ми раді бачити вас знову! Якщо вам потрібна допомога, ми завжди готові допомогти.</p>
        </div>
    </div>
    
    <!-- Приветственный текст (левая сторона для регистрации) -->
    <div id="signup-welcome-panel" class="welcome-panel">
        <div class="welcome-content">
            <h3>ВІТАЄМО!</h3>
            <p>Ми раді вітати вас! Якщо вам потрібна допомога, звертайтеся до нас.</p>
        </div>
    </div>

    <!-- Форма регистрации (правая сторона) -->
    <div id="signup-section">
        <h2 class="form-title">Реєстрація</h2>
        <form method="post" action="{% url 'users:login_signup' %}" autocomplete="off" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="action" value="signup">
            
            <!-- Поля ввода для регистрации -->
            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-person"></i>
                    <input type="text" name="username" id="id_signup_username" placeholder="Логін" required autocomplete="off">
                </div>
                {% if signup_form.username.errors %}
                    <div class="alert alert-danger p-1 small">{{ signup_form.username.errors|join:", " }}</div>
                {% endif %}
            </div>
            
            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-envelope"></i>
                    <input type="email" name="email" id="id_signup_email" placeholder="Електронна пошта" required autocomplete="off">
                </div>
                {% if signup_form.email.errors %}
                    <div class="alert alert-danger p-1 small">{{ signup_form.email.errors|join:", " }}</div>
                {% endif %}
            </div>
            
            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-telephone"></i>
                    <input type="tel" name="phone_number" id="id_phone" placeholder="Номер телефону" required autocomplete="off">
                </div>
                {% if signup_form.phone_number.errors %}
                    <div class="alert alert-danger p-1 small">{{ signup_form.phone_number.errors|join:", " }}</div>
                {% endif %}
            </div>

            <div class="input-field">
                <div class="field-wrapper">
                    <i class="bi bi-lock"></i>
                    <input type="password" name="password1" id="id_signup_password1" placeholder="Пароль" required autocomplete="new-password" minlength="8">
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('id_signup_password1', this)">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
                {% if signup_form.password1.errors %}
                    <div class="alert alert-danger p-1 small">{{ signup_form.password1.errors|join:", " }}</div>
                {% endif %}
            </div>
            
            <!-- Общие ошибки формы регистрации -->
            {% if signup_form.non_field_errors %}
                <div class="alert alert-danger p-1 small">
                    {% for error in signup_form.non_field_errors %}
                       {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            
            <button type="submit" class="btn submit-btn">Зареєструватися</button>
            <p class="switch-text">Вже маєте обліковий запис? <a href="#login-section" id="show-login">Увійти</a></p>
        </form>
    </div>
</div>

<!-- Подключаем скрипт для форм входа и регистрации -->
<script src="{% static 'deps/js/login_signup_form.js' %}"></script>
<script>
    function togglePasswordVisibility(inputId, button) {
        const passwordInput = document.getElementById(inputId);
        const icon = button.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.className = 'bi bi-eye-slash';
        } else {
            passwordInput.type = 'password';
            icon.className = 'bi bi-eye';
        }
    }
</script>

{% endblock content %} 